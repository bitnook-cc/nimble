# Nimble RPG Vault

A Next.js 15 application using Velite for processing markdown content with custom MDX components, searchability, and automatic navigation generation for Nimble RPG documentation.

## Overview

The Vault is a content management system for Nimble RPG rules, lore, and reference materials. It processes markdown files into a searchable, navigable website with custom styling and access control.

## Technology Stack

- **Next.js 15** with App Router and Turbopack
- **Velite** for content processing and MDX compilation
- **TypeScript** for type safety
- **Tailwind CSS** for styling
- **Custom MDX Components** for styled content rendering

## ✅ Implemented Features

### Content Processing with Velite
- Automatic MDX compilation to JavaScript strings
- Table of contents generation
- Reading time calculation
- Metadata extraction (title, description, tags)
- Static route generation

### Access Control System
- **Public Content** (`/docs` routes): Available to all users
- **Patron/Premium Content** (`/patron` routes): Restricted access with authentication placeholders

### Custom MDX Rendering
- Styled components for all HTML elements (h1-h4, p, ul, ol, li, blockquote, code, pre, a, strong, em, table elements)
- Amber color scheme matching the fantasy theme
- Responsive design with proper spacing and typography

### Automatic Navigation
- File structure-based routing
- Dynamic route generation from content folders
- Nested content support

### Content Organization
- Frontmatter support with title, description, category, order, tags, access levels
- Automatic permalink generation
- Category-based organization

## Project Structure

```
apps/vault/
├── content/                    # Content source files
│   ├── public/                # Public content (accessible to all)
│   │   ├── getting-started.md
│   │   └── character-creation.md
│   └── patron/                # Premium content (requires authentication)
│       └── advanced-rules.md
├── src/
│   ├── app/
│   │   ├── docs/[...slug]/    # Public content routes
│   │   │   └── page.tsx
│   │   ├── patron/[...slug]/  # Premium content routes
│   │   │   └── page.tsx
│   │   ├── layout.tsx
│   │   └── page.tsx           # Home page
│   └── components/
│       └── mdx-content.tsx    # Custom MDX renderer
├── .velite/                   # Generated by Velite (build artifacts)
│   ├── docs.json             # Processed public content
│   ├── patron.json           # Processed premium content
│   └── index.d.ts            # Type definitions
├── velite.config.ts          # Velite configuration
├── next.config.js            # Next.js configuration with VeliteWebpackPlugin
├── tailwind.config.ts        # Tailwind CSS configuration
└── tsconfig.json             # TypeScript configuration with path mapping
```

## Development Setup

### Prerequisites
- Node.js 18+
- npm or yarn

### Running the Application

```bash
# Install dependencies
npm install

# Start development server
npm run dev
```

The vault will be available at http://localhost:4321

## Configuration

### Velite Configuration (`velite.config.ts`)

```typescript
{
  root: './content',
  output: {
    data: '.velite',
    assets: 'public/static',
    base: '/static/',
    clean: true
  },
  collections: {
    docs: {
      pattern: ['public/**/*.md', 'public/**/*.mdx'],
      schema: { title, description, category, order, tags, access, content: s.mdx(), toc: s.toc() }
    },
    patron: {
      pattern: ['patron/**/*.md', 'patron/**/*.mdx'],
      schema: { title, description, category, order, tags, access, content: s.mdx(), toc: s.toc() }
    }
  }
}
```

### Next.js Configuration

- **VeliteWebpackPlugin**: Automatically builds content during development
- **Turbopack**: Fast refresh and development builds
- **TypeScript path mapping**: `#site/content` maps to `./.velite`

## Content Format

### Frontmatter Schema

```yaml
---
title: "Page Title"
description: "Page description for SEO and previews"
category: "content-category"
order: 1
tags: ["tag1", "tag2"]
access: ["public"] # or ["patron", "premium"]
---

# Your Content Here

Regular markdown content with support for:
- Headers (h1-h4)
- Lists (ordered and unordered)
- Code blocks with syntax highlighting
- Tables
- Links and emphasis
- Custom components (extensible)
```

### Adding Content

1. **Public Content**: Add `.md` or `.mdx` files to `content/public/`
2. **Premium Content**: Add `.md` or `.mdx` files to `content/patron/`
3. **Include Frontmatter**: All content files should include proper frontmatter
4. **Velite Auto-Processing**: Content is automatically processed on file changes during development

## Technical Implementation

### MDX Processing Flow

1. **Velite Processing**: Markdown files → Compiled JavaScript strings
2. **Runtime Evaluation**: JavaScript strings → React components using `react/jsx-runtime`
3. **Component Injection**: Custom styled components merged with content
4. **Rendering**: Final styled content rendered in pages

### Key Components

#### MDXContent (`src/components/mdx-content.tsx`)

```typescript
// Custom hook for parsing Velite MDX
const useMDXComponent = (code: string) => {
  const fn = new Function(code)
  return fn({ ...runtime }).default
}

// Main component with shared styling
export const MDXContent = ({ code, components }: MDXProps) => {
  const Component = useMDXComponent(code)
  return <Component components={{ ...sharedComponents, ...components }} />
}
```

#### Dynamic Routes

- **Public**: `/docs/[...slug]` - Maps to `content/public/**/*.md`
- **Premium**: `/patron/[...slug]` - Maps to `content/patron/**/*.md`

### Custom Components

The MDX renderer provides styled components:

- **Typography**: Custom styled headers, paragraphs, lists
- **Code**: Syntax-highlighted code blocks with amber theme
- **Tables**: Responsive tables with amber borders
- **Links**: Styled links with hover effects
- **Emphasis**: Custom strong and italic styling

## Development Commands

```bash
npm run dev        # Start development server with Turbopack
npm run build      # Build for production
npm run start      # Start production server
npm run lint       # Run ESLint
npm run typecheck  # Run TypeScript type checking
```

## Known Issues & Limitations

### Current Issues
1. **Next.js 15 Async Params**: Some TypeScript warnings about async params usage
2. **Development Warnings**: Webpack/Turbopack configuration warnings (non-blocking)

### Limitations
1. **Search**: Not yet implemented (content is structured for future search integration)
2. **Authentication**: Access control is placeholder-only
3. **Navigation UI**: Automatic navigation structure exists but UI not yet built
4. **Image Processing**: No image optimization for content assets

## Future Enhancements

### Planned Features

1. **Search Implementation**
   - Full-text search using Fuse.js or similar
   - Category-based filtering
   - Tag-based search
   - Access-level aware search results

2. **Navigation UI**
   - Sidebar navigation component
   - Breadcrumb navigation
   - Category-based organization
   - Mobile-responsive navigation

3. **Authentication Integration**
   - JWT-based access control
   - Integration with existing portal authentication
   - Subscription-level content gating

4. **Enhanced Content Features**
   - Image optimization and processing
   - Custom MDX components (cards, callouts, etc.)
   - Interactive elements
   - Cross-referencing between content

## Troubleshooting

### Common Issues

1. **Content not updating**: Restart development server to refresh Velite cache
2. **TypeScript errors**: Run `npm run typecheck` to identify issues
3. **Build failures**: Check Velite configuration and content frontmatter format

### Debug Information

- **Velite output**: Check `.velite/` directory for processed content
- **Route generation**: Verify `generateStaticParams` output in build logs
- **Content validation**: Velite will report schema validation errors

---

*Last updated: September 30, 2025*
