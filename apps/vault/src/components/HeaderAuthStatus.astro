---
import { getAuthFromRequestSafe, isSessionExpired } from '../lib/auth'

const authInfo = await getAuthFromRequestSafe(Astro.request)
---

<div class="auth-status-header">
  {authInfo ? (
    <div class="authenticated">
      <span class="status-icon">‚úÖ</span>
      <span class="user-info">
        {authInfo.user.email}
        {authInfo.hasPatronAccess && (
          <span class="patron-badge">Patron</span>
        )}
      </span>
      {isSessionExpired(authInfo.session) && (
        <span class="expired-warning">‚ö†Ô∏è</span>
      )}
    </div>
  ) : (
    <div class="not-authenticated">
      <span class="status-icon">üîí</span>
      <a href="https://nimble-tools.vercel.app" class="login-link">Sign In</a>
    </div>
  )}
</div>

<style>
  .auth-status-header {
    display: flex;
    align-items: center;
    font-size: 0.875rem;
    white-space: nowrap;
  }

  .authenticated,
  .not-authenticated {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .status-icon {
    font-size: 1rem;
  }

  .user-info {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    color: var(--sl-color-text);
  }

  .patron-badge {
    background: linear-gradient(135deg, #ff6b6b, #ee5a24);
    color: white;
    padding: 0.125rem 0.375rem;
    border-radius: 0.25rem;
    font-size: 0.75rem;
    font-weight: bold;
    text-transform: uppercase;
  }

  .expired-warning {
    color: #ff6b6b;
    font-size: 0.875rem;
  }

  .login-link {
    color: var(--sl-color-text-accent);
    text-decoration: none;
    font-weight: 500;
  }

  .login-link:hover {
    text-decoration: underline;
  }

  /* Responsive design for smaller screens */
  @media (max-width: 640px) {
    .user-info {
      max-width: 120px;
      overflow: hidden;
      text-overflow: ellipsis;
    }
  }
</style>